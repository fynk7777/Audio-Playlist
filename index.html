<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drag-and-Drop Audio Playlist</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        .file-input {
            margin-bottom: 20px;
        }

        .playlist-container {
            display: flex;
            gap: 20px;
        }

        .playlist, .available-songs {
            width: 45%;
            min-height: 200px;
            border: 1px solid #ccc;
            padding: 10px;
            border-radius: 5px;
            background-color: #f9f9f9;
        }

        .playlist.dragover, .available-songs.dragover {
            background-color: #e0f7fa;
        }

        .song-item {
            padding: 5px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 3px;
            background-color: #fff;
            cursor: grab;
        }

        .controls {
            margin-top: 10px;
        }

        .controls button {
            margin-right: 5px;
        }

        .controls input[type="range"] {
            margin-right: 5px;
        }

        .volume-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        .volume-controls input[type="number"] {
            width: 60px;
        }

        .song-volume {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 5px;
        }

        .song-volume input[type="range"] {
            flex: 1;
        }

        .song-volume input[type="number"] {
            width: 60px;
        }
    </style>
</head>
<body>
    <h1>Drag-and-Drop Audio Playlist</h1>
    <div class="file-input">
        <label for="audio-files">Upload Audio Files:</label>
        <input type="file" id="audio-files" multiple accept="audio/*">
    </div>

    <div class="volume-controls">
        <label for="global-volume">Global Volume:</label>
        <input type="range" id="global-volume" min="0" max="1" step="0.01" value="1">
        <input type="number" id="global-volume-number" min="0" max="100" step="1" value="100">
    </div>

    <div class="playlist-container">
        <div class="available-songs" id="available-songs">
            <h3>Available Songs</h3>
        </div>
        <div class="playlist" id="playlist">
            <h3>Playlist</h3>
        </div>
    </div>

    <div class="controls">
        <button id="play-all">Play All</button>
        <button id="loop-playlist">Loop Playlist</button>
    </div>

    <audio id="audio-player" controls style="width: 100%; margin-top: 20px;"></audio>

    <script>
        const audioFilesInput = document.getElementById('audio-files');
        const availableSongs = document.getElementById('available-songs');
        const playlist = document.getElementById('playlist');
        const audioPlayer = document.getElementById('audio-player');
        const playAllButton = document.getElementById('play-all');
        const loopPlaylistButton = document.getElementById('loop-playlist');
        const globalVolumeSlider = document.getElementById('global-volume');
        const globalVolumeNumber = document.getElementById('global-volume-number');

        let currentSongIndex = 0;
        let playlistSongs = [];
        let isPlaylistLooping = false;
        const songVolumes = new Map();
        let globalVolume = 1;

        // Sync global volume slider and number input
        globalVolumeSlider.addEventListener('input', (e) => {
            globalVolume = parseFloat(e.target.value);
            globalVolumeNumber.value = (globalVolume * 100).toFixed(0);
            saveState();
        });

        globalVolumeNumber.addEventListener('input', (e) => {
            const value = Math.min(100, Math.max(0, parseInt(e.target.value)));
            globalVolume = value / 100;
            globalVolumeSlider.value = globalVolume;
            saveState();
        });

        // Add drag-and-drop functionality
        function enableDragAndDrop(container) {
            container.addEventListener('dragover', (e) => {
                e.preventDefault();
                container.classList.add('dragover');
            });

            container.addEventListener('dragleave', () => {
                container.classList.remove('dragover');
            });

            container.addEventListener('drop', (e) => {
                e.preventDefault();
                container.classList.remove('dragover');

                const songId = e.dataTransfer.getData('text');
                const songElement = document.getElementById(songId);

                if (container === playlist && !playlist.contains(songElement)) {
                    playlist.appendChild(songElement);
                    playlistSongs.push(songElement.getAttribute('data-src'));
                } else if (container === availableSongs && !availableSongs.contains(songElement)) {
                    availableSongs.appendChild(songElement);
                    playlistSongs = playlistSongs.filter(src => src !== songElement.getAttribute('data-src'));
                }
                saveState();
            });
        }

        enableDragAndDrop(availableSongs);
        enableDragAndDrop(playlist);

        // Handle file upload
        audioFilesInput.addEventListener('change', () => {
            Array.from(audioFilesInput.files).forEach(file => {
                const songId = `song-${file.name.replace(/\s+/g, '-')}`;

                if (!document.getElementById(songId)) {
                    const songItem = document.createElement('div');
                    songItem.className = 'song-item';
                    songItem.id = songId;
                    songItem.draggable = true;
                    songItem.textContent = file.name;
                    songItem.setAttribute('data-src', URL.createObjectURL(file));

                    songItem.addEventListener('dragstart', (e) => {
                        e.dataTransfer.setData('text', songItem.id);
                    });

                    // Add volume slider for each song
                    const volumeControls = document.createElement('div');
                    volumeControls.className = 'song-volume';

                    const volumeSlider = document.createElement('input');
                    volumeSlider.type = 'range';
                    volumeSlider.min = 0;
                    volumeSlider.max = 1;
                    volumeSlider.step = 0.01;
                    volumeSlider.value = 1;

                    const volumeNumber = document.createElement('input');
                    volumeNumber.type = 'number';
                    volumeNumber.min = 0;
                    volumeNumber.max = 100;
                    volumeNumber.step = 1;
                    volumeNumber.value = 100;

                    volumeSlider.addEventListener('input', (e) => {
                        const value = e.target.value;
                        volumeNumber.value = (value * 100).toFixed(0);
                        songVolumes.set(songItem.getAttribute('data-src'), parseFloat(value));
                        saveState();
                    });

                    volumeNumber.addEventListener('input', (e) => {
                        const value = Math.min(100, Math.max(0, parseInt(e.target.value)));
                        volumeSlider.value = value / 100;
                        songVolumes.set(songItem.getAttribute('data-src'), value / 100);
                        saveState();
                    });

                    volumeControls.appendChild(volumeSlider);
                    volumeControls.appendChild(volumeNumber);

                    songItem.appendChild(volumeControls);
                    availableSongs.appendChild(songItem);

                    // Initialize volume map
                    songVolumes.set(songItem.getAttribute('data-src'), 1);
                    saveState();
                }
            });
        });

        // Play all songs in playlist
        playAllButton.addEventListener('click', () => {
            if (playlistSongs.length > 0) {
                currentSongIndex = 0;
                playSong(currentSongIndex);
            }
        });

        function playSong(index) {
            if (index < playlistSongs.length) {
                const currentSong = playlistSongs[index];
                const songVolume = songVolumes.get(currentSong) || 1;
                audioPlayer.src = currentSong;
                audioPlayer.volume = songVolume * globalVolume;
                audioPlayer.volume = songVolume * globalVolume;
                audioPlayer.play();
                audioPlayer.onended = () => {
                    if (index + 1 < playlistSongs.length) {
                        playSong(index + 1);
                    } else if (isPlaylistLooping) {
                        playSong(0);
                    }
                };
            }
        }

        // Toggle playlist looping
        loopPlaylistButton.addEventListener('click', () => {
            isPlaylistLooping = !isPlaylistLooping;
            loopPlaylistButton.textContent = isPlaylistLooping ? 'Stop Looping Playlist' : 'Loop Playlist';
        });

        // Save state to localStorage
        function saveState() {
            const state = {
                playlistSongs,
                globalVolume,
                songVolumes: Array.from(songVolumes.entries()),
            };
            localStorage.setItem('audioPlaylistState', JSON.stringify(state));
        }

        // Load state from localStorage
        function loadState() {
            const savedState = localStorage.getItem('audioPlaylistState');
            if (savedState) {
                const { playlistSongs: savedPlaylist, globalVolume: savedGlobalVolume, songVolumes: savedSongVolumes } = JSON.parse(savedState);
                playlistSongs = savedPlaylist || [];
                globalVolume = savedGlobalVolume || 1;
                globalVolumeSlider.value = globalVolume;
                globalVolumeNumber.value = (globalVolume * 100).toFixed(0);
                savedSongVolumes.forEach(([src, volume]) => songVolumes.set(src, volume));

                playlistSongs.forEach(src => {
                    const songItem = Array.from(availableSongs.children).find(item => item.getAttribute('data-src') === src);
                    if (songItem) {
                        playlist.appendChild(songItem);
                    }
                });
            }
        }

        // Initialize
        loadState();
    </script>
</body>
</html>
